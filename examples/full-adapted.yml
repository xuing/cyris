---
#########################################################################################
# Adapted full cyber range configuration for current environment
# This configuration creates a complete cyber range with desktop, webserver, and firewall
#########################################################################################

- host_settings:
  - id: host_1
    mgmt_addr: localhost
    virbr_addr: 192.168.122.1
    account: ubuntu

- guest_settings:
  # Desktop VM with security tools and attack simulations
  - id: desktop
    ip_addr: 192.168.122.50
    basevm_host: host_1
    basevm_config_file: /home/ubuntu/cyris/images/basevm.xml
    basevm_type: kvm
    tasks:
    - add_account:
      - account: daniel
        passwd: danielpass
        full_name: Daniel Radcliffe
    
    - modify_account:
      - account: root
        new_passwd: abcd1234
    
    - install_package:
      - package_manager: apt-get
        name: nmap
      - package_manager: apt-get
        name: wireshark
    
    - emulate_attack:
      - attack_type: ssh_attack
        target_account: daniel
        attempt_number: 200
        attack_time: 2025-08-21
    
    - emulate_traffic_capture_file:
      - format: pcap
        file_name: /home/daniel/traffic_ssh.pcap
        attack_type: ssh_attack
        attack_source: 192.168.122.100
        noise_level: medium
    
    - emulate_malware:
      - name: test_daemon
        mode: dummy_calculation
        cpu_utilization: 30

  # Web server VM
  - id: webserver
    ip_addr: 192.168.122.51
    basevm_host: host_1
    basevm_config_file: /home/ubuntu/cyris/images/basevm.xml
    basevm_type: kvm
    tasks:
    - add_account:
      - account: webadmin
        passwd: webpass123
        full_name: Web Administrator
    
    - modify_account:
      - account: root
        new_passwd: webroot123
    
    - install_package:
      - package_manager: apt-get
        name: apache2
      - package_manager: apt-get
        name: php
      - package_manager: apt-get
        name: mysql-server
    
    - emulate_traffic_capture_file:
      - format: pcap
        file_name: /home/webadmin/ddos_traffic.pcap
        attack_type: ddos_attack
        noise_level: medium

  # Firewall VM
  - id: firewall
    ip_addr: 192.168.122.10
    basevm_host: host_1
    basevm_config_file: /home/ubuntu/cyris/images/basevm.xml
    basevm_type: kvm
    tasks:
    - add_account:
      - account: fwadmin
        passwd: firewall123
        full_name: Firewall Administrator
    
    - install_package:
      - package_manager: apt-get
        name: iptables
      - package_manager: apt-get
        name: ufw

- clone_settings:
  - range_id: 777
    hosts:
    - host_id: host_1
      instance_number: 1
      guests:
      # Desktop as entry point
      - guest_id: desktop
        number: 1
        entry_point: yes
      
      # Web server
      - guest_id: webserver
        number: 1
      
      # Firewall with forwarding rules
      - guest_id: firewall
        number: 1
        forwarding_rules:
        - rule: src=office dst=servers dport=80,443,22
      
      topology:
      - type: custom
        networks:
        # Office network with desktop
        - name: office
          members: desktop.eth0
          gateway: firewall.eth0
        
        # Server network with webserver
        - name: servers
          members: webserver.eth0
          gateway: firewall.eth1